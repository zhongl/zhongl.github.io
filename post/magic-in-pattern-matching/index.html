<!DOCTYPE html><html lang="zh-CN"><head><title>æ¨¡å¼åŒ¹é…é‡Œçš„é­”æ³•</title><meta charset="utf-8" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="description" content="é²œä¸ºäººçŸ¥ç¼–è¯‘å™¨çš„å·¥ä½œç»†èŠ‚ï¼Œå¤§å¤šä¼šè¢«æˆ‘ä»¬å«åšâ€œé­”æ³•â€ã€‚" /><meta name="viewport" content="width=device-width" /><link rel="stylesheet" type="text/css" href="/style.css" /><link rel="apple-touch-icon" size="180x180" href="/apple-touch-icon.png" /><link rel="icon" type="image/png" size="32x32" href="/favicon-32x32.png" /><link rel="icon" type="image/png" size="16x16" href="/favicon-16x16.png" /><link rel="manifest" href="/site.webmanifest" /><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-REFRQT9XHR"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-REFRQT9XHR');
</script></head><body><main><menu><div><a href="/post/">ğš²</a></div></menu><article><header><time datetime="2024-09-04">Sep 4, 2024</time><h1>æ¨¡å¼åŒ¹é…é‡Œçš„é­”æ³•</h1></header><div class="lead">
<p>é²œä¸ºäººçŸ¥ç¼–è¯‘å™¨çš„å·¥ä½œç»†èŠ‚ï¼Œå¤§å¤šä¼šè¢«æˆ‘ä»¬å«åšâ€œé­”æ³•â€ã€‚</p>
</div>
<p>æ¥ä¸Šå›ï¼Œæˆ‘å£°æ˜äº† <code>type Mutation = (URL, Seq[Element])</code>
ï¼Œå³å°†ç‰¹å®š <code>URL</code> é¡µé¢å†…å®¹ä¸­ æ–°å¢çš„è‹¥å¹²
<code>Seq[Element]</code> ç§°ä¹‹ä¸º <code>Mutation</code>
ï¼ˆå˜åŒ–ï¼‰ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œå›  <em>å˜åŒ–</em> äº§ç”Ÿçš„åç»­ä»£ç é€»è¾‘ï¼Œéƒ½å¾—ä»åˆ¤æ–­
<em>å˜åŒ–</em> æ»¡è¶³ä»€ä¹ˆæ¡ä»¶å¼€å§‹ã€‚ä¸ºäº†è®©ä»£ç çœ‹ä¸Šå»ç®€æ´ä¸”å¯Œè¡¨è¾¾åŠ›ï¼Œæˆ‘ç»™
<strong>æ¨¡å¼åŒ¹é…</strong> æ–½åŠ ä¸€äº›é­”æ³•ğŸª„ã€‚</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="ex">Callback</span> <span class="op">=</span> Mutation <span class="op">=&gt;</span> <span class="bu">Unit</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span>url<span class="op">,</span> added<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">???</span></span></code></pre></div>
<p>åœ¨ <code>URL</code> ä¸­ï¼Œæˆ‘æœ€å…³å¿ƒæ˜¯ <code>pathname</code> <a
href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>å’Œ <code>search</code> <a href="#fn2"
class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a>ä¸¤éƒ¨åˆ†ã€‚ä»¥æ‰€æœ‰è·‘æ­¥æ´»åŠ¨çš„é¡µé¢é“¾æ¥ä¸ºä¾‹ï¼Œ</p>
<figure>
<img src="runnings.png" alt="æ’å…¥é€Ÿå¿ƒæ¯”èµ°åŠ¿çš„æ´»åŠ¨é¡µ" />
<figcaption aria-hidden="true">æ’å…¥é€Ÿå¿ƒæ¯”èµ°åŠ¿çš„æ´»åŠ¨é¡µ</figcaption>
</figure>
<p>å…¶ <code>pathname</code> ä¸º
<code>/modern/activities</code>ï¼Œ<code>search</code> æ˜¯
<code>activityType=running</code>ã€‚ç„¶åï¼Œæˆ‘æ–½åŠ ç¬¬ä¸€é“ï¼Œæœ€å…¥é—¨ä¹Ÿæœ€æ ¸å¿ƒçš„é­”æ³•
<a href="#fn3" class="footnote-ref" id="fnref3"
role="doc-noteref"><sup>3</sup></a>ã€‚</p>
<h2 id="æ¶ˆå¤±çš„-unapply">æ¶ˆå¤±çš„ <code>unapply</code></h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> <span class="ex">URL</span><span class="op">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">unapply</span><span class="op">(</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    u<span class="op">:</span> <span class="ex">URL</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">):</span> <span class="ex">Option</span><span class="op">[(</span><span class="ex">String</span><span class="op">,</span> <span class="ex">String</span><span class="op">)]</span> <span class="op">=</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Some</span><span class="op">(</span>u<span class="op">.</span>pathname<span class="op">,</span> u<span class="op">.</span>search<span class="op">)</span></span></code></pre></div>
<p><code>unapply</code>
æ˜¯ä¸€ä¸ªç‰¹æ®Šå‘½åçš„æ–¹æ³•ï¼Œå¦‚åŒé­”æ³•çš„å’’è¯­ï¼Œæ–½æ³•æ•ˆæœä¸º</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span><span class="ex">URL</span><span class="op">(</span>pathname<span class="op">,</span> search<span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">???</span></span></code></pre></div>
<p>ç»™ä¸æ˜è§‰å‰çš„æœ‹å‹ç¿»è¯‘ç¿»è¯‘ï¼Œå°±æ˜¯ï¼š</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> <span class="op">(</span>url<span class="op">,</span> _<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> opt <span class="op">=</span> <span class="ex">URL</span><span class="op">.</span><span class="fu">unapply</span><span class="op">(</span>url<span class="op">)</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> opt<span class="op">.</span>isDefined then</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> <span class="op">(</span>pathname<span class="op">,</span> search<span class="op">)</span> <span class="op">=</span> opt<span class="op">.</span>get</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">???</span></span></code></pre></div>
<p>ç®€è¨€ä¹‹ï¼Œè°ƒç”¨ <code>unapply</code>
ï¼Œåˆ¤æ–­è¿”å›å€¼ï¼Œè‹¥å­˜åœ¨åˆ™èµ‹å€¼å¹¶ç»§ç»­ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤ç²¾ç‚¼ä¸ºäº†ä¸€è¡Œä»£ç ã€‚æœ‰ç‚¹
<em>è§£æ„èµ‹å€¼</em> <a href="#fn4" class="footnote-ref" id="fnref4"
role="doc-noteref"><sup>4</sup></a>é‚£å‘³äº†ï¼Œä½†è¿œä¸æ­¢å¦‚æ­¤ã€‚æ¥ä¸‹æ¥ï¼Œå°±æ˜¯è¦åˆ†åˆ«åˆ¤æ–­
<code>pathname</code> å’Œ <code>search</code> äº†ï¼Œä½†ä¾æ—§ä¸ç”¨
<code>if</code>ï¼Œ</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span><span class="ex">URL</span><span class="op">(</span><span class="st">&quot;/modern/activities&quot;</span><span class="op">,</span> <span class="st">&quot;activityType=running&quot;</span><span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">???</span></span></code></pre></div>
<p>å¯èƒ½æœ‰ Scala
çš„æœ‹å‹çœ‹åˆ°è¿™é‡Œï¼Œè§‰å¾—å¤ªå°å„¿ç§‘å§ã€‚åˆ«èµ°ï¼Œä¸‹é¢æˆ‘è¦å¼€å§‹è£…é€¼äº†ï¼</p>
<p>æ³¨æ„ï¼Œä»¥ä¸Š <code>search</code> æ˜¯æœ€å•çº¯çš„æƒ…å†µã€‚å®é™…ä¸Šï¼Œå®ƒå¯èƒ½æ˜¯ï¼š</p>
<ul>
<li><code>activityType=cycling</code></li>
<li><code>activityType=running&amp;search=MAF</code></li>
<li><code>&lt;empty&gt;</code></li>
</ul>
<p>ä¸ºäº†ç®€æ´åˆæœ‰ï¼ˆè¡¨è¾¾ï¼‰åŠ›ï¼Œæˆ‘å†™æˆè¿™æ ·ï¼Œ</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span><span class="ex">URL</span><span class="op">(</span>_<span class="op">,</span> Param<span class="op">[</span><span class="st">&quot;activityType&quot;</span><span class="op">](</span><span class="st">&quot;running&quot;</span><span class="op">)),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">???</span></span></code></pre></div>
<p>å¦‚ä½•ï¼Œæœ‰æ²¡æœ‰ä¸€ç‚¹å°å°çš„éœ‡æ’¼ï¼Ÿè¿™å°±æ˜¯åœ¨åŸºç¡€çš„é­”æ³•ä¸Šï¼Œå åŠ äº¿ç‚¹ç‚¹ğŸ¤é«˜é˜¶é­”æ³•äº†ã€‚</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> Param<span class="op">:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> unapply<span class="op">[</span>S <span class="op">&lt;:</span> <span class="ex">String</span><span class="op">:</span> ValueOf<span class="op">](</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    sp<span class="op">:</span> URLSearchParams </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">):</span> <span class="ex">Option</span><span class="op">[</span><span class="ex">String</span><span class="op">]</span> <span class="op">=</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> key <span class="op">=</span> valueOf<span class="op">[</span>S<span class="op">]</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Option</span><span class="op">.</span>when</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>sp<span class="op">.</span><span class="fu">has</span><span class="op">(</span>key<span class="op">))</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>sp<span class="op">.</span><span class="fu">get</span><span class="op">(</span>key<span class="op">))</span></span></code></pre></div>
<div class="alert" data-icon="î¢">
<p>ä¸ºäº†é…åˆ <code>Param</code> ï¼Œè§£æ„ <code>URL</code> æ—¶éœ€è¦ç”¨
<code>searchParams</code> <a href="#fn5" class="footnote-ref"
id="fnref5" role="doc-noteref"><sup>5</sup></a>ï¼Œæ¯” <code>search</code>
å®ç°æ›´ç®€å•ã€‚</p>
</div>
<p>å…¶ä¸­æ¶‰åŠä¸€ä¸ªå†·é—¨çŸ¥è¯†ç‚¹: <strong>Literal-based singleton
types</strong> ï¼ˆå­—é¢å•ä¾‹ç±»å‹ï¼‰<a href="#fn6" class="footnote-ref"
id="fnref6" role="doc-noteref"><sup>6</sup></a>ã€‚ç®€è¨€ä¹‹ï¼Œä½¿ç”¨
<code>valueOf</code> å¯ä»¥è·å–å­—é¢å•ä¾‹ç±»å‹ <code>"activityType"</code>
çš„å­—ç¬¦ä¸²å€¼ï¼ˆä¹Ÿå°±æ˜¯å®ƒè‡ªèº«ï¼‰ã€‚å½“ç„¶ï¼Œè¿˜éœ€è¦è¾…ä»¥
<code>[S &lt;: String: ValueOf]</code> çš„å£°æ˜ï¼Œè¿™åˆæ¶‰åŠåˆ°çŸ¥è¯†ç‚¹
<strong>Type Bounds</strong> ï¼ˆç±»å‹çº¦æŸï¼‰<a href="#fn7"
class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> å’Œ
<strong>Context Bounds</strong> ï¼ˆä¸Šä¸‹æ–‡ç»‘å®šï¼‰ <a href="#fn8"
class="footnote-ref" id="fnref8"
role="doc-noteref"><sup>8</sup></a>ã€‚</p>
<p>ä»¥ä¸Šå†™æ³•æºè‡ª Scala Contributors é‡Œã€ŒMore Useful Pattern
Matchingã€çš„å¸–å­ <a href="#fn9" class="footnote-ref" id="fnref9"
role="doc-noteref"><sup>9</sup></a>ã€‚è´´ä¸»æ˜¯æƒ³è®¨è®º Scala è¦ä¸è¦æ”¯æŒ
<strong>Parameterized Active Patterns</strong> ï¼ˆå‚æ•°åŒ–æ¿€æ´»æ¨¡å¼ï¼‰<a
href="#fn10" class="footnote-ref" id="fnref10"
role="doc-noteref"><sup>10</sup></a>ã€‚å¯æƒœæ¥¼æ­ªäº†ï¼Œå¼•å‘äº†ä¸€åœºæœ‰è¶£çš„ä»£ç ç«èµ›ï¼Œå³ä¾¿æ˜¯æœ‰
Lihaoyi å›å¸–æ­£æ¥¼ä¹Ÿæ— äº‹äºè¡¥ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å‚è§è„šæ³¨é“¾æ¥ã€‚</p>
<h2 id="string-interpolate-çš„æ„å¤–ä¹‹ç”¨">String Interpolate
çš„æ„å¤–ä¹‹ç”¨</h2>
<p>ä½œä¸ºç¬¬ä¸€ä¸ªå›å¸–çš„äººï¼Œæˆ‘å¯èƒ½æœ‰ä¸€ç‚¹ç‚¹æ­ªæ¥¼çš„è´£ä»»ğŸ˜‚ã€‚ä½† <strong>String
Interpolate</strong> ï¼ˆå­—ç¬¦ä¸²æ’å€¼ï¼‰<a href="#fn11" class="footnote-ref"
id="fnref11"
role="doc-noteref"><sup>11</sup></a>ä¹Ÿå¯ç”¨äºæ¨¡å¼åŒ¹é…ï¼Œè¿™ç»å¯¹æ˜¯ Scala Doc
éƒ½æ²¡æåˆ°çš„â€œå†°ç³»â€é­”æ³•ã€‚</p>
<p>è¿˜æ˜¯æ‹¿ <code>pathname</code> ä¸¾ä¾‹è¯´æ˜ã€‚å‡è®¾ï¼Œæˆ‘è¦åŒ¹é…ä¸ªäººèµ„æ–™é¡µï¼Œ</p>
<pre><code>/modern/profile/{id}</code></pre>
<p>ä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼Œ</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span><span class="ex">URL</span><span class="op">(</span><span class="ss">s&quot;</span><span class="st">/modern/profile/</span><span class="ss">$id&quot;</span><span class="op">,</span> _<span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">???</span></span></code></pre></div>
<p>ç†Ÿæ‚‰ Scala
çš„æœ‹å‹ï¼Œå’‹çœ‹å¯èƒ½ä¼šæœ‰ç‚¹ã€Œåœ°é“è€äººçœ‹æ‰‹æœºã€ï¼Œå…¶å®ç»†æƒ³æƒ³è¿˜æŒºç¬¦åˆç›´è§‰çš„ç”¨æ³•ã€‚æ—¢ç„¶éƒ½è¯´åˆ°è¿™äº†ï¼Œä¸å¦¨å†å®¹æˆ‘ç‚«ä¸ªåå¤šå¹´å‰çš„é›•è™«å°æŠ€ã€‚</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span><span class="ex">URL</span><span class="op">(</span>r<span class="st">&quot;/modern/profile/(</span><span class="ch">\\</span><span class="st">d+)$id&quot;</span><span class="op">,</span> _<span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">???</span></span></code></pre></div>
<p><code>r</code> ä¸æ˜¯ <code>StringContext</code> å†…ç½®çš„ï¼Œæ˜¯é€šè¿‡
<code>Regex</code> æ¥æ‰©å±•å®ç°çš„ <a href="#fn12" class="footnote-ref"
id="fnref12" role="doc-noteref"><sup>12</sup></a></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> scala<span class="op">.</span>util<span class="op">.</span>matching<span class="op">.</span>Regex</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">extension</span> <span class="op">(</span>sc<span class="op">:</span> StringContext<span class="op">)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> r <span class="op">=</span> <span class="fu">Regex</span><span class="op">(</span>sc<span class="op">.</span>parts<span class="op">.</span>mkString<span class="op">)</span></span></code></pre></div>
<p>è¿™ä¸ªæŠ€å·§æ˜¯ä» Hacking Scala ä¸Šå­¦æ¥çš„<a href="#fn13"
class="footnote-ref" id="fnref13"
role="doc-noteref"><sup>13</sup></a>ï¼Œåœ¨å¤§é‡å­—ç¬¦æ•°æ®å¤„ç†åœºæ™¯ä¸­ç›¸å½“å¥½ç”¨ï¼Œçœå»å¾ˆå¤šæ— èŠçš„å£°æ˜å®šä¹‰è¯­å¥ï¼Œè¿™ä¹Ÿæ˜¯ã€ŒMore
Useful Pattern Matchingã€å¸–å­èƒŒåçš„ç—›ç‚¹ã€‚</p>
<h2 id="é­”æ³•ä¸ä¸ºç‚«æŠ€">é­”æ³•ä¸ä¸ºç‚«æŠ€</h2>
<p>å½“å¹´åœ¨å‚å†…ä½¿ç”¨è¿™äº›é­”æ³•ï¼Œæ²¡å°‘è¢«åŒå­¦èƒŒåœ°é‡Œåæ§½ğŸ˜‚ï¼ŒçœŸæ˜¯è‹¦äº†ä»–ä»¬äº†ã€‚æˆ‘ä½¿ç”¨çš„åˆè¡·ï¼Œå½“ç„¶ä¸æ˜¯ä¸ºäº†ç‚«æŠ€ï¼Œè€Œæ˜¯è®©ä»£ç ç®€æ´æœ‰åŠ›ã€‚åªæ˜¯ç”¨ä¸Šå¤´äº†ï¼Œéš¾å…æŠŠæ¡ä¸å¥½åº¦ï¼Œåœ¨å›¢é˜ŸååŒæ•ˆç‡ä¸Šé€ æˆé¢å¤–éšå½¢æˆæœ¬ã€‚</p>
<p>è¿™ä¸æ˜¯ä¸€ä¸ªç”¨æˆ–ä¸ç”¨çš„äºŒå…ƒé€‰æ‹©ï¼Œè€Œæ˜¯ä¸€ç§æƒè¡¡ã€‚ä»Šå¤©ï¼Œé­”æ³•æˆ‘ä¾ç„¶åœ¨ç”¨ï¼Œåªä¸è¿‡ç”¨çš„æ—¶å€™è€ƒè™‘çš„æ›´å¤šäº›ã€‚</p>
<h2 id="æ–‡æœ«å½©è›‹">æ–‡æœ«å½©è›‹</h2>
<div class="sourceCode" id="cb12"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> scala<span class="op">.</span>languageFeature<span class="op">.</span>implicitConversions</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> sourcecode<span class="op">.</span><span class="ex">Name</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Extract<span class="op">[</span>A<span class="op">,</span> B<span class="op">]</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">=</span> A <span class="op">=&gt;</span> <span class="ex">Option</span><span class="op">[</span>B<span class="op">]</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> LiteralExtract<span class="op">[</span>A<span class="op">,</span> B<span class="op">]</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">=</span> <span class="ex">String</span> <span class="op">=&gt;</span> Extract<span class="op">[</span>A<span class="op">,</span> B<span class="op">]</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>given <span class="op">[</span>A<span class="op">,</span> B<span class="op">]:</span> Conversion<span class="op">[</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  Extract<span class="op">[</span>A<span class="op">,</span> B<span class="op">],</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">PartialFunction</span><span class="op">[</span>A<span class="op">,</span> B<span class="op">]</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="op">]</span> <span class="op">=</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  _<span class="op">.</span>unlift</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> <span class="ex">Attr</span><span class="op">:</span> LiteralExtract<span class="op">[</span><span class="ex">Element</span><span class="op">,</span> <span class="ex">String</span><span class="op">]</span> <span class="op">=</span> </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  k <span class="op">=&gt;</span> e <span class="op">=&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Option</span><span class="op">.</span>when</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>e<span class="op">.</span><span class="fu">hasAttribute</span><span class="op">(</span>k<span class="op">))</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>e<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>k<span class="op">))</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> `href` <span class="op">=</span> <span class="ex">Attr</span><span class="op">(</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  implicitly<span class="op">[</span><span class="ex">Name</span><span class="op">].</span>value</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="op">)</span>          </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> callback<span class="op">:</span> <span class="ex">Callback</span> <span class="op">=</span> </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span>_<span class="op">,</span> added<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="cf">case</span> `href`<span class="op">(</span>url<span class="op">)</span> <span class="op">&lt;-</span> added <span class="cf">do</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>      <span class="op">???</span></span></code></pre></div>
<p>ä¸¤ç‚¹æç¤ºï¼š</p>
<ul>
<li><code>sourcecode.Name</code> <a href="#fn14" class="footnote-ref"
id="fnref14" role="doc-noteref"><sup>14</sup></a></li>
<li><code>unlift</code> <a href="#fn15" class="footnote-ref"
id="fnref15" role="doc-noteref"><sup>15</sup></a></li>
</ul>
<p>å¾…ç»­å›è§ã€‚</p>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><a
href="https://developer.mozilla.org/en-US/docs/Web/API/URL/pathname"
class="uri"
target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/URL/pathname</a><a
href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2"><p><a
href="https://developer.mozilla.org/en-US/docs/Web/API/URL/search"
class="uri"
target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/URL/search</a><a
href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn3"><p><a
href="https://docs.scala-lang.org/tour/extractor-objects.html"
class="uri"
target="_blank">https://docs.scala-lang.org/tour/extractor-objects.html</a><a
href="#fnref3" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn4"><p><a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"
class="uri"
target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment</a><a
href="#fnref4" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn5"><p><a
href="https://developer.mozilla.org/en-US/docs/Web/API/URL/searchParams"
class="uri"
target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/URL/searchParams</a><a
href="#fnref5" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn6"><p><a href="https://docs.scala-lang.org/sips/42.type.html"
class="uri"
target="_blank">https://docs.scala-lang.org/sips/42.type.html</a><a
href="#fnref6" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn7"><p><a
href="https://docs.scala-lang.org/tour/upper-type-bounds.html"
class="uri"
target="_blank">https://docs.scala-lang.org/tour/upper-type-bounds.html</a><a
href="#fnref7" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn8"><p><a
href="https://docs.scala-lang.org/scala3/book/ca-context-bounds.html#inner-main"
class="uri"
target="_blank">https://docs.scala-lang.org/scala3/book/ca-context-bounds.html#inner-main</a><a
href="#fnref8" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn9"><p><a
href="https://contributors.scala-lang.org/t/more-useful-pattern-matching/6751"
class="uri"
target="_blank">https://contributors.scala-lang.org/t/more-useful-pattern-matching/6751</a><a
href="#fnref9" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn10"><p><a
href="https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/active-patterns#parameterized-active-patterns"
class="uri"
target="_blank">https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/active-patterns#parameterized-active-patterns</a><a
href="#fnref10" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn11"><p><a
href="https://docs.scala-lang.org/scala3/book/string-interpolation.html"
class="uri"
target="_blank">https://docs.scala-lang.org/scala3/book/string-interpolation.html</a><a
href="#fnref11" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn12"><p><a
href="https://docs.scala-lang.org/tour/regular-expression-patterns.html#inner-main"
class="uri"
target="_blank">https://docs.scala-lang.org/tour/regular-expression-patterns.html#inner-main</a><a
href="#fnref12" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn13"><p><a
href="https://hacking-scala.tumblr.com/post/50360896036/regular-expressions-interpolation-in-pattern"
class="uri"
target="_blank">https://hacking-scala.tumblr.com/post/50360896036/regular-expressions-interpolation-in-pattern</a><a
href="#fnref13" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn14"><p><a
href="https://github.com/com-lihaoyi/sourcecode/tree/main" class="uri"
target="_blank">https://github.com/com-lihaoyi/sourcecode/tree/main</a><a
href="#fnref14" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn15"><p><a
href="https://docs.scala-lang.org/sips/converters-among-optional-functions-partialfunctions-and-extractor-objects.html#inner-main"
class="uri"
target="_blank">https://docs.scala-lang.org/sips/converters-among-optional-functions-partialfunctions-and-extractor-objects.html#inner-main</a><a
href="#fnref15" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section>
<nav class="not-prose"><ul><li><a href="/post/#/plog"><span class="icons-outlined align-bottom">tag</span>ç å¿—</a></li></ul></nav><img class="mx-auto size-80 grayscale" src="/qrcode_wechat.jpg" /></article><footer><p><span>Â©</span>2025 zhongl.fun</p></footer></main></body></html>